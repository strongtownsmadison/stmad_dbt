{{
    config(
        tags=['parcels']
    )
}}

select 
    (feature_data -> 'properties' ->> 'OBJECTID')::numeric as obj_id,
    feature_data -> 'properties' ->> 'Parcel' as parcel_id,
    feature_data -> 'properties' ->> 'XRefParcel' as x_ref_parcel,
    feature_data -> 'properties' ->> 'Address' as parcel_address,
    feature_data -> 'properties' ->> 'DateParcelChanged' as date_parcel_changed,
    feature_data -> 'properties' ->> 'PropertyClass' as property_class,
    feature_data -> 'properties' ->> 'PropertyUse' as property_use,
    (feature_data -> 'properties' ->> 'AssessmentArea')::numeric as assessment_area,
    feature_data -> 'properties' ->> 'AreaName' as area_name,
    feature_data -> 'properties' ->> 'MoreThanOneBuild' as more_than_one_build,
    feature_data -> 'properties' ->> 'HomeStyle' as home_style,
    (feature_data -> 'properties' ->> 'YearBuilt')::numeric as year_built,
    (feature_data -> 'properties' ->> 'Bedrooms')::numeric as bedrooms,
    (feature_data -> 'properties' ->> 'FullBaths')::numeric as full_baths,
    (feature_data -> 'properties' ->> 'HalfBaths')::numeric as half_baths,
    (feature_data -> 'properties' ->> 'TotalLivingArea')::numeric as total_living_area,
    (feature_data -> 'properties' ->> 'FirstFloor')::numeric as first_floor,
    (feature_data -> 'properties' ->> 'SecondFloor')::numeric as second_floor,
    (feature_data -> 'properties' ->> 'ThirdFloor')::numeric as third_floor,
    (feature_data -> 'properties' ->> 'AboveThirdFloor')::numeric as above_third_floor,
    (feature_data -> 'properties' ->> 'FinishedAttic')::numeric as finished_attic,
    (feature_data -> 'properties' ->> 'Basement')::numeric as basement,
    (feature_data -> 'properties' ->> 'FinishedBasement')::numeric as finished_basement,
    feature_data -> 'properties' ->> 'ExteriorWall1' as exterior_wall_1,
    feature_data -> 'properties' ->> 'ExteriorWall2' as exterior_wall_2,
    (feature_data -> 'properties' ->> 'Fireplaces')::numeric as fireplaces,
    feature_data -> 'properties' ->> 'CentralAir' as central_air,
    feature_data -> 'properties' ->> 'PartialAssessed' as partial_assessed,
    feature_data -> 'properties' ->> 'AssessedByState' as assessed_by_state,
    (feature_data -> 'properties' ->> 'CurrentLand')::numeric as current_land,
    (feature_data -> 'properties' ->> 'CurrentImpr')::numeric as current_impr,
    (feature_data -> 'properties' ->> 'CurrentTotal')::numeric as current_total,
    (feature_data -> 'properties' ->> 'PreviousLand')::numeric as previous_land,
    (feature_data -> 'properties' ->> 'PreviousImpr')::numeric as previous_impr,
    (feature_data -> 'properties' ->> 'PreviousTotal')::numeric as previous_total,
    (feature_data -> 'properties' ->> 'NetTaxes')::numeric as net_taxes,
    (feature_data -> 'properties' ->> 'SpecialAssmnt')::numeric as special_assmnt,
    (feature_data -> 'properties' ->> 'OtherCharges')::numeric as other_charges,
    (feature_data -> 'properties' ->> 'TotalTaxes')::numeric as total_taxes,
    (feature_data -> 'properties' ->> 'LotSize')::numeric as lot_size,
    feature_data -> 'properties' ->> 'Zoning1' as zoning_1,
    feature_data -> 'properties' ->> 'Zoning2' as zoning_2,
    feature_data -> 'properties' ->> 'Zoning3' as zoning_3,
    feature_data -> 'properties' ->> 'Zoning4' as zoning_4,
    feature_data -> 'properties' ->> 'FrontageStreet' as frontage_street,
    feature_data -> 'properties' ->> 'WaterFrontage' as water_frontage,
    (feature_data -> 'properties' ->> 'TIFDistrict')::numeric as tif_district,
    feature_data -> 'properties' ->> 'TaxSchoolDist' as tax_school_dist,
    feature_data -> 'properties' ->> 'AttendanceSchool' as attendance_school,
    feature_data -> 'properties' ->> 'ElementarySchool' as elementary_school,
    feature_data -> 'properties' ->> 'MiddleSchool' as middle_school,
    feature_data -> 'properties' ->> 'HighSchool' as high_school,
    (feature_data -> 'properties' ->> 'Ward')::numeric as ward,
    (feature_data -> 'properties' ->> 'StateAssemblyDistrict')::numeric as state_assembly_district,
    feature_data -> 'properties' ->> 'RefuseDistrict' as refuse_district,
    feature_data -> 'properties' ->> 'RefuseURL' as refuse_url,
    (feature_data -> 'properties' ->> 'PreviousLand2')::numeric as previous_land_2,
    (feature_data -> 'properties' ->> 'PreviousImpr2')::numeric as previous_impr_2,
    (feature_data -> 'properties' ->> 'PreviousTotal2')::numeric as previous_total_2,
    (feature_data -> 'properties' ->> 'AlderDistrict')::numeric as alder_district,
    feature_data -> 'properties' ->> 'AssessmentChangeDate' as assessment_change_date,
    feature_data -> 'properties' ->> 'BlockNumber' as block_number,
    (feature_data -> 'properties' ->> 'BuildingDistrict')::numeric as building_district,
    feature_data -> 'properties' ->> 'CapitolFireDistrict' as capitol_fire_district,
    feature_data -> 'properties' ->> 'ConditionalUse' as conditional_use,
    feature_data -> 'properties' ->> 'CouncilHold' as council_hold,
    feature_data -> 'properties' ->> 'DateAdded' as date_added,
    (feature_data -> 'properties' ->> 'DeedPage')::numeric as deed_page,
    (feature_data -> 'properties' ->> 'DeedRestriction')::numeric as deed_restriction,
    (feature_data -> 'properties' ->> 'DeedVolume')::numeric as deed_volume,
    (feature_data -> 'properties' ->> 'ElectricalDistrict')::numeric as electrical_district,
    (feature_data -> 'properties' ->> 'EnvHealthDistrict')::numeric as env_health_district,
    feature_data -> 'properties' ->> 'ExemptionType' as exemption_type,
    (feature_data -> 'properties' ->> 'FireDistrict')::numeric as fire_district,
    (feature_data -> 'properties' ->> 'FloodPlain')::numeric as flood_plain,
    feature_data -> 'properties' ->> 'FuelStorageProximity' as fuel_storage_proximity,
    (feature_data -> 'properties' ->> 'HeatingDistrict')::numeric as heating_district,
    feature_data -> 'properties' ->> 'Holds' as holds,
    (feature_data -> 'properties' ->> 'IllegalLandDivision')::numeric as illegal_land_division,
    feature_data -> 'properties' ->> 'LandfillProximity' as landfill_proximity,
    feature_data -> 'properties' ->> 'LandfillRemediation' as landfill_remediation,
    feature_data -> 'properties' ->> 'Landmark' as landmark,
    (feature_data -> 'properties' ->> 'LandscapeBuffer')::numeric as landscape_buffer,
    feature_data -> 'properties' ->> 'LocalHistoricalDist' as local_historical_dist,
    (feature_data -> 'properties' ->> 'LotDepth')::numeric as lot_depth,
    (feature_data -> 'properties' ->> 'LotNumber')::numeric as lot_number,
    feature_data -> 'properties' ->> 'LotType1' as lot_type_1,
    feature_data -> 'properties' ->> 'LotType2' as lot_type_2,
    (feature_data -> 'properties' ->> 'LotWidth')::numeric as lot_width,
    feature_data -> 'properties' ->> 'MCDCode' as mcd_code,
    (feature_data -> 'properties' ->> 'NationalHistoricalDist')::numeric as national_historical_dist,
    feature_data -> 'properties' ->> 'NeighborhoodDesc' as neighborhood_desc,
    feature_data -> 'properties' ->> 'NeighborhoodPrimary' as neighborhood_primary,
    feature_data -> 'properties' ->> 'NeighborhoodSub' as neighborhood_sub,
    feature_data -> 'properties' ->> 'NeighborhoodVuln' as neighborhood_vuln,
    feature_data -> 'properties' ->> 'NoiseAirport' as noise_airport,
    feature_data -> 'properties' ->> 'NoiseRailroad' as noise_railroad,
    feature_data -> 'properties' ->> 'NoiseStreet' as noise_street,
    feature_data -> 'properties' ->> 'ObsoleteDate' as obsolete_date,
    feature_data -> 'properties' ->> 'OwnerChangeDate' as owner_change_date,
    feature_data -> 'properties' ->> 'OwnerOccupied' as owner_occupied,
    feature_data -> 'properties' ->> 'ParcelChangeDate' as parcel_change_date,
    feature_data -> 'properties' ->> 'ParcelCode' as parcel_code,
    feature_data -> 'properties' ->> 'ParkProximity' as park_proximity,
    feature_data -> 'properties' ->> 'Pending' as pending,
    feature_data -> 'properties' ->> 'PlanningDistrict' as planning_district,
    (feature_data -> 'properties' ->> 'PlumbingDistrict')::numeric as plumbing_district,
    feature_data -> 'properties' ->> 'PoliceDistrict' as police_district,
    (feature_data -> 'properties' ->> 'PoliceSector')::numeric as police_sector,
    feature_data -> 'properties' ->> 'PreviousClass' as previous_class,
    (feature_data -> 'properties' ->> 'PropertyUseCode')::numeric as property_use_code,
    feature_data -> 'properties' ->> 'RailroadFrontage' as railroad_frontage,
    feature_data -> 'properties' ->> 'ReasonChangeImpr' as reason_change_impr,
    feature_data -> 'properties' ->> 'ReasonChangeLand' as reason_change_land,
    (feature_data -> 'properties' ->> 'SenateDistrict')::numeric as senate_district,
    (feature_data -> 'properties' ->> 'SupervisorDistrict')::numeric as supervisor_district,
    feature_data -> 'properties' ->> 'TifImpr' as tif_impr,
    feature_data -> 'properties' ->> 'TifLand' as tif_land,
    feature_data -> 'properties' ->> 'TifYear' as tif_year,
    (feature_data -> 'properties' ->> 'TotalDwellingUnits')::numeric as total_dwelling_units,
    feature_data -> 'properties' ->> 'TrafficAnalysisZone' as traffic_analysis_zone,
    feature_data -> 'properties' ->> 'TypeWaterFrontage' as type_water_frontage,
    feature_data -> 'properties' ->> 'UWPolice' as uw_police,
    feature_data -> 'properties' ->> 'WetlandInfo' as wetland_info,
    feature_data -> 'properties' ->> 'ZoningAll' as zoning_all,
    feature_data -> 'properties' ->> 'ZoningBoardAppeal' as zoning_board_appeal,
    feature_data -> 'properties' ->> 'UrbanDesignDistrict' as urban_design_district,
    (feature_data -> 'properties' ->> 'HouseNbr')::numeric as house_nbr,
    feature_data -> 'properties' ->> 'StreetDir' as street_dir,
    feature_data -> 'properties' ->> 'StreetName' as street_name,
    feature_data -> 'properties' ->> 'StreetType' as street_type,
    feature_data -> 'properties' ->> 'Unit' as unit,
    feature_data -> 'properties' ->> 'StreetID' as street_id,
    feature_data -> 'properties' ->> 'StormOutfall' as storm_outfall,
    feature_data -> 'properties' ->> 'FireDemandZone' as fire_demand_zone,
    feature_data -> 'properties' ->> 'FireDemandSubZone' as fire_demand_sub_zone,
    feature_data -> 'properties' ->> 'PropertyChangeDate' as property_change_date,
    (feature_data -> 'properties' ->> 'MaxConstructionYear')::numeric as max_construction_year,
    (feature_data -> 'properties' ->> 'XCoord')::numeric as x_coord,
    (feature_data -> 'properties' ->> 'YCoord')::numeric as y_coord,
    (feature_data -> 'properties' ->> 'SHAPE_Length')::numeric as shape_length,
    (feature_data -> 'properties' ->> 'SHAPE_Area')::numeric as shape_area,
    st_geomfromgeojson(feature_data ->> 'geometry') as geom_4326,
    date_part('year', load_dttm) as parcel_year,
    load_dttm
from {{ source('city_of_madison','parcels_geojson') }}